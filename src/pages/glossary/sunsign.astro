---
import "@/assets/styles/varnmala/index.css";
import "@/assets/styles/varnmala/sunsign.css";
import BaseLayout from "@/layouts/Base";
import BackButton from "@/components/ui/backButton.astro";
import SunSignCard, { type SunSignEntry } from "@/components/SunSignCards.astro";
import glossaryData from "../../data/glossary.json";

const pageTitle = glossaryData.sunsign.title;

// Original data is now imported from the JSON file
const sunSignsDataRaw: Omit<SunSignEntry, "parsedHindiLetters" | "parsedEnglishLetters">[] = glossaryData.sunsign.data;

// Process data to include parsedHindiLetters and parsedEnglishLetters
const processedSunSignsData = sunSignsDataRaw.map((sign) => {
  const letterPairs = sign.firstLetters
    ? sign.firstLetters
        .split(",")
        .map((p) => p.trim())
        .filter((p) => p)
    : [];
  const englishLettersArray: string[] = [];
  const hindiLettersArray: string[] = [];

  letterPairs.forEach((pair) => {
    const match = pair.match(/^([A-Za-z\s]+)\s*\(([^)]+)\)$/);
    if (match && match[1] && match[2]) {
      englishLettersArray.push(match[1].trim());
      hindiLettersArray.push(match[2].trim());
    } else {
      const singleLetterMatch = pair.match(/^([A-Za-z\s]+)$/);
      if (singleLetterMatch && singleLetterMatch[1]) {
        englishLettersArray.push(singleLetterMatch[1].trim());
      }
    }
  });

  return {
    ...sign,
    parsedHindiLetters: hindiLettersArray.join(", "),
    parsedEnglishLetters: englishLettersArray.join(", ")
  };
});
---

<BaseLayout meta={{ title: pageTitle }}>
  <BackButton href="/glossary" />
  <div class="container__page sun-sign-page-container">
    <div class="page-header">
      <h1 class="page-main-title">{pageTitle}</h1>
      <button id="flip-all-sunsigns-button" class="flip__all__button">Flip All Cards</button>
    </div>

    <div class="grid-container sun-signs-grid">
      {processedSunSignsData.map((sign) => <SunSignCard item={sign} />)}
    </div>
  </div>
</BaseLayout>