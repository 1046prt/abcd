---
import "@/assets/styles/astrology.css";
import "@/assets/styles/zodiac.css";
import Back from "@/components/Back.astro";
import Help from "@/components/Help.astro";
import SharePopover from "@/components/ShareButton.astro";
import BaseLayout from "@/layouts/Base";
import LanguageSwitcher from "@/components/LanguageSwitcher.astro";
import ZodiacTab from "@/components/ZodiacTab.astro";
import NakshatraTab from "@/components/NakshatraTab.astro";
---

<BaseLayout meta={{ title: "Zodiac" }}>
  <Back />
  <Fragment slot="header-right">
    <LanguageSwitcher />
    <SharePopover />
    <Help title="Zodiac" description="Explore Zodiacs and Nakshtras." />
  </Fragment>

  <div class="container__astrology">
    <!-- Tab Buttons -->
    <div class="tab-buttons">
      <button class="tab-button active" data-tab="zodiac">Zodiac Signs</button>
      <button class="tab-button" data-tab="nakshtra">Nakshtra</button>
    </div>

    <!-- Zodiac Signs Tab Content -->
    <div id="zodiac-tab-content" class="tab-content active">
      <ZodiacTab />
    </div>

    <!-- Nakshatra Tab Content -->
    <div id="nakshtra-tab-content" class="tab-content">
      <NakshatraTab />
    </div>
  </div>
</BaseLayout>

<script is:inline>
  // --- Language Switching Logic ---
  function setLanguage(lang) {
    localStorage.setItem("language", lang);
    document.documentElement.lang = lang === "hindi" ? "hi" : "en";

    const englishButtons = document.querySelectorAll("#englishBtn");
    const hindiButtons = document.querySelectorAll("#hindiBtn");

    englishButtons.forEach((btn) => btn.classList.toggle("active", lang === "english"));
    hindiButtons.forEach((btn) => btn.classList.toggle("active", lang === "hindi"));

    // Dispatch a custom event that the components can listen for
    window.dispatchEvent(new CustomEvent("languagechange", { detail: { language: localStorage.getItem("language") } }));
  }

  // --- Tab Switching and Initialization Logic ---
  document.addEventListener("DOMContentLoaded", () => {
    // Initialize language switcher
    const initialLang = localStorage.getItem("language") || "english";
    const englishButtons = document.querySelectorAll("#englishBtn");
    const hindiButtons = document.querySelectorAll("#hindiBtn");

    englishButtons.forEach((btn) => btn.addEventListener("click", () => setLanguage("english")));
    hindiButtons.forEach((btn) => btn.addEventListener("click", () => setLanguage("hindi")));
    setLanguage(initialLang); // Set initial language on page load

    // Tab switching logic
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        tabButtons.forEach((btn) => btn.classList.remove("active"));
        tabContents.forEach((content) => content.classList.remove("active"));

        button.classList.add("active");
        const targetTab = button.dataset.tab;
        if (targetTab) {
          document.getElementById(`${targetTab}-tab-content`)?.classList.add("active");
        }
      });
    });
  });
</script>
